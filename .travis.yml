# DESCRIPTION: Travis-CI config
#
# Copyright 2003-2019 by Todd Strader. Verilator is free software; you can
# redistribute it and/or modify it under the terms of either the GNU Lesser
# General Public License Version 3 or the Perl Artistic License Version 2.0.

language: cpp
os: linux

#matrix:
#  include:
## Non-cron build will split the tests up into three parts
##   and just run on whatever linux flavor we get
#    - if: type != cron
#      os: linux
#      compiler: gcc
#      env:
#        - SCENARIOS=--dist
#    - if: type != cron
#      os: linux
#      compiler: gcc
#      env:
#        - SCENARIOS=--vlt
#    - if: type != cron
#      os: linux
#      compiler: gcc
#      env:
#        - SCENARIOS=--vltmt
## Cron builds do not split up tests and try different OS/compiler combinations
#    - if: type = cron
#      dist: xenial
#      compiler: gcc
#    - if: type = cron
#      dist: xenial
#      compiler: clang
#    - if: type = cron
#      os: osx
#      compiler: gcc
#    - if: type = cron
#      dist: trusty
#      compiler: gcc
compiler: clang

cache: ccache

# Some tests require gdb
addons:
  apt:
    packages:
      - gdb

before_install:
# Perl modules needed for testing
  - apt-cache search clang
  - yes yes | sudo cpan -fi Unix::Processors Parallel::Forker Bit::Vector
before_script:
  - export VLT_JOBS=$((`nproc` + 1))
  - export OBJCACHE=ccache
  - export VERILATOR_ROOT=`pwd`
  - autoconf
script:
  - >
    ./configure --enable-maintainer-mode --enable-longtests &&
    make -j $VLT_JOBS &&
    ./test_regress/t/t_interface_gen8.pl
#    make test_regress DRIVER_FLAGS="-j 0 --quiet --rerun"
after_script:
  - ccache -s
