# Travis-CI config
language: cpp
compiler: gcc
cache: ccache

# Some tests require gdb
addons:
  apt:
    packages:
    - gdb

env:
  - TEST=--dist
  - TEST=--vlt
  - TEST=--vltmt

before_install:
# Trusty has an old version of make
# t_flag_csplit needs a newer version of make than 3.81
  - >
    if [ $TRAVIS_DIST == "trusty" ]; then
      pushd /tmp &&
      wget http://ftp.gnu.org/gnu/make/make-4.1.tar.gz &&
      tar xvf make-4.1.tar.gz &&
      cd make-4.1/ &&
      ./configure &&
      make &&
      ./make --version &&
      sudo make install &&
      popd &&
      export PATH=/usr/local/bin:$PATH;
      fi
# Perl modules needed for testing
  - yes yes | sudo cpan -fi Unix::Processors Parallel::Forker Bit::Vector
before_script:
  - autoconf
  - export VLT_JOBS=$((`nproc` + 1))
  - export OBJCACHE=ccache
  - ccache -s
script:
  - >
    ./configure --enable-maintainer-mode --enable-longtests &&
    make -j $VLT_JOBS &&
    make test SCENARIOS=$TEST
after_script:
  - ccache -s

# Trying ccache again
